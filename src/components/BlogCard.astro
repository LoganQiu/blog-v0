---
import type { CollectionEntry } from "astro:content";
import Meta from "./Meta.astro";
import { getPostPath } from "@/utils/getPostPath";
import { getStatusMeta } from "@/utils/status";

export interface Props {
  post: CollectionEntry<"blog">;
}

const { post } = Astro.props;
const postPath = getPostPath(post);
const { status, isPinned, isDeprecated, badgeClass } = getStatusMeta(post.data.status);
const cardClasses = [
  "relative border border-dashed border-muted/40 p-4 mb-4 hover:border-foreground",
  isPinned ? "bg-lime-500/5 hover:border-lime-500" : "",
  isDeprecated ? "bg-red-500/5 hover:border-red-500" : "",
]
  .filter(Boolean)
  .join(" ");
---

<div class={cardClasses}>
  <h2
    class="text-xl font-semibold mt-0 border-0 mb-2 flex flex-wrap items-center gap-2"
    transition:name={`blog-title-${post.data.slug}`}
  >
    <a
      href={postPath}
      class:list={{
        "line-through text-muted": isDeprecated,
      }}
    >
      {post.data.title}
    </a>
    {status && badgeClass && <span class={badgeClass}>{status}</span>}
    {post.data.subtitle && (
      <small class="text-muted font-normal italic basis-full">{post.data.subtitle}</small>
    )}
  </h2>
  <Meta
    transition:name={`blog-meta-${post.data.slug}`}
    pubdate={post.data.pubdate}
    moddate={post.data.moddate}
    categories={post.data.categories}
    tags={post.data.tags}
  />
  {post.data.desc && <p class="mb-0">{post.data.desc}</p>}
  <div></div>
</div>
